<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
  <title>Cart - Vâ€™Best Luxury Interiors</title>
  <style>
    /* Amazon-like light theme â€” only theme changed */
    :root{
      --accent: #ff9900;
      --bg: #f4f4f6;
      --card: #ffffff;
      --text: #111;
      --muted: #6b6b6b;
      --danger: #d32f2f;
      --success: #27ae60;
    }

    body { font-family: Arial, sans-serif; background:var(--bg); color:var(--text); margin:0; padding:20px; }
    h1 { text-align:center; margin-bottom:20px; color:var(--text); }
    table { width:100%; border-collapse:collapse; margin-bottom:20px; background:var(--card); border-radius:8px; overflow:hidden; box-shadow:0 6px 18px rgba(0,0,0,0.06);}
    thead th { background: #fff8f0; color:var(--text); padding:12px; text-align:center; border-bottom:1px solid #eee; font-weight:700; }
    th, td { padding:12px; border-bottom:1px solid #f0f0f0; text-align:center; vertical-align:middle; color:var(--text); }
    img { width:80px; height:60px; border-radius:6px; object-fit:cover; display:block; margin:0 auto; }
    input, button, select { padding:10px; margin:6px 0; width:100%; border-radius:6px; border:1px solid #e6e6e6; box-sizing:border-box; font-size:14px; }
    input[type="email"], input[type="text"] { background:#fff; color:var(--text); }
    .checkout-btn { background:var(--accent); color:#111; font-weight:900; cursor:pointer; border: none; }
    .checkout-btn[disabled] { opacity:0.6; cursor:not-allowed; }
    .summary { text-align:center; margin-bottom:20px; font-size:18px; font-weight:bold; color:var(--text); }
    button.remove-btn { background:transparent; border:1px solid #f1c27d; color:var(--danger); padding:6px 10px; border-radius:5px; cursor:pointer; }
    .small-muted { font-size:0.9rem; color:var(--muted); text-align:center; margin-top:8px; }
    .container { max-width:980px; margin:0 auto; }
    form.card { background:var(--card); padding:16px; border-radius:8px; box-shadow:0 6px 18px rgba(0,0,0,0.04); }
    label { display:block; font-weight:700; margin-bottom:6px; color:var(--text); }
    .row { display:flex; gap:12px; flex-wrap:wrap; }
    .col-2 { flex:1 1 calc(50% - 6px); min-width:200px; }
    .full { width:100%; }
    .hint { font-size:13px; color:var(--muted); margin-top:6px; }
  </style>

  <!-- TikTok Pixel Code Start -->
<script>
!function (w, d, t) {
  w.TiktokAnalyticsObject=t;var ttq=w[t]=w[t]||[];ttq.methods=["page","track","identify","instances","debug","on","off","once","ready","alias","group","enableCookie","disableCookie","holdConsent","revokeConsent","grantConsent"],ttq.setAndDefer=function(t,e){t[e]=function(){t.push([e].concat(Array.prototype.slice.call(arguments,0)))}};for(var i=0;i<ttq.methods.length;i++)ttq.setAndDefer(ttq,ttq.methods[i]);ttq.instance=function(t){for(
var e=ttq._i[t]||[],n=0;n<ttq.methods.length;n++)ttq.setAndDefer(e,ttq.methods[n]);return e},ttq.load=function(e,n){var r="https://analytics.tiktok.com/i18n/pixel/events.js",o=n&&n.partner;ttq._i=ttq._i||{},ttq._i[e]=[],ttq._i[e]._u=r,ttq._t=ttq._t||{},ttq._t[e]=+new Date,ttq._o=ttq._o||{},ttq._o[e]=n||{};n=document.createElement("script")
;n.type="text/javascript",n.async=!0,n.src=r+"?sdkid="+e+"&lib="+t;e=document.getElementsByTagName("script")[0];e.parentNode.insertBefore(n,e)};


  ttq.load('D3FQ2UBC77U2R2QSQ1HG');
  ttq.page();
}(window, document, 'ttq');
</script>
<!-- TikTok Pixel Code End -->
<!-- Facebook Pixel Code --><script>!function(f,b,e,v,n,t,s){if(f.fbq)return;n=f.fbq=function(){n.callMethod?n.callMethod.apply(n,arguments):n.queue.push(arguments)};if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0';n.queue=[];t=b.createElement(e);t.async=!0;t.src=v;s=b.getElementsByTagName(e)[0];s.parentNode.insertBefore(t,s)}(window,document,'script','https://connect.facebook.net/en_US/fbevents.js'); fbq('init', '677322691667443'); fbq('track', 'PageView');</script><noscript> <img height="1" width="1" src="https://www.facebook.com/tr?id=677322691667443&ev=PageView&noscript=1"/></noscript><!-- End Facebook Pixel Code -->
</head>
<body>
  <div class="container">
    <h1>ðŸ›’ Your Cart</h1>

    <table id="cart-table" aria-live="polite">
      <thead>
        <tr>
          <th>#</th>
          <th>Product</th>
          <th>Image</th>
          <th>Price (â‚¦)</th>
          <th>Action</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>

    <div class="summary" id="total-amount">Total Amount: â‚¦0</div>

    <h2>Customer Details</h2>

    <!-- KEEP original logic but replace form with Amazon-style customer details (State + Town) -->
    <form id="checkout-form" class="card" onsubmit="return false;">
      <div class="row">
        <div class="col-2">
          <label for="name">Full Name</label>
          <input type="text" id="name" placeholder="Full Name" required>
        </div>
        <div class="col-2">
          <label for="phone">Phone Number</label>
          <input type="text" id="phone" placeholder="Phone Number" required>
        </div>
      </div>

      <div class="row">
        <div class="col-2">
          <label for="email">Email</label>
          <input type="email" id="email" placeholder="Email" required>
        </div>

        <div class="col-2">
          <label for="stateInput">State (type to search)</label>
          <input list="stateList" id="stateInput" placeholder="Select state">
          <datalist id="stateList"></datalist>
        </div>
      </div>

      <div class="row">
        <div class="full">
          <label for="areaSelect">Town / Area / City</label>
          <select id="areaSelect"><option value="">Select state first</option></select>
          <div class="hint">Choose town or major area in selected state.</div>
        </div>
      </div>

      <div class="row">
        <div class="full">
          <label for="address">Delivery Address</label>
          <input type="text" id="address" placeholder="House no, street, estate, nearest landmark" required>
        </div>
      </div>

      <div class="row">
        <div class="full">
          <button type="button" class="checkout-btn" id="checkoutBtn">Checkout</button>
        </div>
      </div>

      <div class="small-muted" id="status-msg"></div>
    </form>
  </div>

  <!-- Firebase module helper (exposes saveOrderToRealtime) -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/12.2.1/firebase-app.js";
    import { getDatabase, ref, push, set, serverTimestamp } from "https://www.gstatic.com/firebasejs/12.2.1/firebase-database.js";

    const firebaseConfig = {
      apiKey: "AIzaSyAF_Fy32TmyNOAYebcRCcOLhgcKn82Xavs",
      authDomain: "v-best-luxury-interiors.firebaseapp.com",
      databaseURL: "https://v-best-luxury-interiors-default-rtdb.firebaseio.com",
      projectId: "v-best-luxury-interiors",
      storageBucket: "v-best-luxury-interiors.firebasestorage.app",
      messagingSenderId: "331900870737",
      appId: "1:331900870737:web:c100c6a2987345eb955870",
      measurementId: "G-NP94R6352Q"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    // Expose helper to save orders to Realtime DB
    window.saveOrderToRealtime = async function(orderData) {
      // Attach server timestamp sentinel
      orderData.createdAt = serverTimestamp();
      const newRef = push(ref(db, "orders"));
      await set(newRef, orderData);
      return { key: newRef.key };
    };

    window.__firebase_ready = true;
  </script>

  <script>
    // ---------- Utilities (unchanged behavior) ----------
    function escapeHtml(str) {
      if (str === null || str === undefined) return "";
      return String(str).replace(/[&<>"']/g, function (m) {
        return ({ '&': '&amp;', '<': '&lt;', '>': '&gt;', '"': '&quot;', "'": '&#39;' })[m];
      });
    }

    function waitFor(conditionFn, timeout = 5000, interval = 150) {
      const start = Date.now();
      return new Promise((resolve) => {
        (function check() {
          try { if (conditionFn()) return resolve(true); } catch(e){}
          if (Date.now() - start >= timeout) return resolve(false);
          setTimeout(check, interval);
        })();
      });
    }

    // ---------- Cart parsing (supports several localStorage keys) ----------
    const possibleKeys = ["cart", "cartItems", "myCart", "items", "vbCart"];

    function parseStoredCart() {
      for (const key of possibleKeys) {
        const raw = localStorage.getItem(key);
        if (!raw) continue;
        try {
          const parsed = JSON.parse(raw);
          if (!parsed) continue;
          if (Array.isArray(parsed)) return { items: normalizeItems(parsed), key };
          if (typeof parsed === "object") {
            const values = Object.values(parsed);
            if (values.length > 0 && typeof values[0] === "object") return { items: normalizeItems(values), key };
            return { items: normalizeItems([parsed]), key };
          }
        } catch (e) {
          console.warn("Could not parse localStorage key", key, e);
        }
      }
      const raw = localStorage.getItem("cart");
      if (raw) {
        try {
          const parsed = JSON.parse(raw);
          if (Array.isArray(parsed)) return { items: normalizeItems(parsed), key: "cart" };
        } catch (e) {}
      }
      return { items: [], key: "cart" };
    }

    function normalizeItems(arr) {
      return arr.map(rawItem => {
        if (typeof rawItem === "string") {
          try { rawItem = JSON.parse(rawItem); } catch (e) { return { name: rawItem, image: "", price: 0, quantity: 1 }; }
        }
        const name = rawItem.name || rawItem.title || rawItem.product || rawItem.label || "Product";
        const image = rawItem.image || rawItem.img || rawItem.picture || rawItem.src || "";
        let priceRaw = rawItem.price ?? rawItem.amount ?? rawItem.cost ?? rawItem.priceText ?? 0;
        if (typeof priceRaw === "string") priceRaw = priceRaw.replace(/[^0-9.]/g, "");
        const price = parseFloat(priceRaw) || 0;
        const quantity = Math.max(1, parseInt(rawItem.quantity) || parseInt(rawItem.qty) || 1);
        return { name: String(name), image: String(image), price, quantity };
      });
    }

    // ---------- Rendering (unchanged logic) ----------
    let cart = [];
    let cartKey = "cart";

    const tbody = document.querySelector("#cart-table tbody");
    const totalAmountEl = document.getElementById("total-amount");
    const statusMsg = document.getElementById("status-msg");
    const checkoutBtn = document.getElementById("checkoutBtn");

    function renderCart() {
      const stored = parseStoredCart();
      cart = stored.items || [];
      cartKey = stored.key || "cart";

      tbody.innerHTML = "";
      if (!cart.length) {
        tbody.innerHTML = `<tr><td colspan="5">Your cart is empty.</td></tr>`;
        totalAmountEl.textContent = "Total Amount: â‚¦0";
        return;
      }

      let totalAmount = 0;
      cart.forEach((item, index) => {
        const itemTotal = (item.price || 0) * (item.quantity || 1);
        totalAmount += itemTotal;

        const nameSafe = escapeHtml(item.name);
        const imgSrc = escapeHtml(item.image || "");
        const priceDisplay = "â‚¦" + itemTotal.toLocaleString();

        tbody.insertAdjacentHTML("beforeend", `
          <tr>
            <td>${index + 1}</td>
            <td style="max-width:200px; white-space:normal; text-align:left;">${nameSafe}</td>
            <td>${imgSrc ? `<img src="${imgSrc}" alt="${nameSafe}">` : ""}</td>
            <td>${priceDisplay}</td>
            <td><button class="remove-btn" onclick="removeProduct(${index})">Remove</button></td>
          </tr>
        `);
      });

      totalAmountEl.textContent = "Total Amount: â‚¦" + totalAmount.toLocaleString();
    }

    // Remove product
    window.removeProduct = function(index) {
      if (!Array.isArray(cart)) return;
      cart.splice(index, 1);
      localStorage.setItem(cartKey, JSON.stringify(cart));
      renderCart();
    };

    // ---------- MAJOR TOWNS for each state (expanded to include all 36 + FCT with many towns) ----------
    // Only customer-details data change â€” everything else unchanged
    const MAJOR_TOWNS = {
      "Abia": ["Aba","Umuahia","Ohafia","Isiala-Ngwa","Umunneochi","Bende","Arochukwu","Ukwa East","Ukwa West","Ugwunagbo","Osisioma Ngwa","Ikwuano","Umuahia North","Umuahia South","Isuikwuato","Obingwa","Aba North","Aba South","Umuahia Town","Isu","Naze","Ubahu","Eziukwu","Ihunta","Aba Old Market","Aba New Road","Ibeku","Arochukwu Town","Ndoki"],
      "Adamawa": ["Yola","Jimeta","Mubi","Numan","Hong","Ganye","Gombi","Maiha","Michika","Demsa","Song","Toungo","Lamurde","Jada","Madagali","Mubi North","Mubi South","Numan Town","Girei","Fufore","Gombi Town","Hildi","Jada Town","Mubi Town","Yola North","Yola South","Jimeta Market","Gurin","Wuro-Birnie"],
      "Akwa Ibom": ["Uyo","Eket","Ikot Ekpene","Oron","Ibeno","Onna","Mbo","Mkpat-Enin","Nsit Ibom","Etinan","Essien Udim","Ikono","Ibiono-Ibom","Obot Akara","Okobo","Ibesikpo Asutan","Uruan","Urue-Offong/Oruko","Ukanafun","Udung Uko","Nsit Ubium","Nsit Atai","Abak","Ikot-Abasi","Esit-Eket","Oron Town","Ibeno Beach","Idua","Eket Town"],
      "Anambra": ["Awka","Onitsha","Nnewi","Ekwulobia","Ihiala","Ogbaru","Aguata","Njikoka","Anaocha","Idemili North","Idemili South","Nnewi North","Nnewi South","Igbariam","Umunze","Otuocha","Atani","Onitsha North","Onitsha South","Orumba","Aguata Town","Adazi-Nnukwu","Neni","Uke","Nkpor","Awka-Etiti","Ogbunka","Abatete","Nnewi Market"],
      "Bauchi": ["Bauchi","Azare","Ningi","Jama'are","Toro","Alkaleri","Misau","Damban","Darazo","Katagum","Ganjuwa","Itas/Gadau","Shira","Warji","Giade","Dass","Sakaba","Kirfi","Bogoro","Zaki","Alkaleri Town","Bauchi Town","Azare Market","Hausa Quarters","Dutse","Katagum Town","Tafawa Balewa","Sade","Zungur"],
      "Bayelsa": ["Yenagoa","Ogbia","Brass","Nembe","Sagbama","Ekeremor","Southern Ijaw","Oporoma","Amassoma","Okpoama","Twon-Brass","Okaka","Kaiama","Etuoke","Otuasega","Igbogene","Odi","Igbotom","Opokuma","Yenagoa Town","Azama","Kolokuma","Torugbene","Kaiama Town","Oporoma Town","Biseni","Otuabagi","Okaka Town","Igbema"],
      "Benue": ["Makurdi","Gboko","Otukpo","Ugbokolo","Adikpo","Oju","Otukpo Town","Ado","Agatu","Kwande","Konshisha","Apa","Buruku","Logo","Ukum","Ushongo","Tarka","Guma","Gwer East","Gwer West","Aliade","Gboko Market","Otukpa","Zaki Biam","Makurdi North","Makurdi South","Adoka","Markudi","Obagaji"],
      "Borno": ["Maiduguri","Biu","Dikwa","Bama","Damboa","Gwoza","Kukawa","Monguno","Ngala","Gubio","Askira-Uba","Hawul","Kaga","Kala/Balge","Magumeri","Marte","Shani","Mobbar","Jere","Biu Town","Maiduguri North","Maiduguri South","Ngala Town","Gajiram","Babur","Damboa Town","Gwoza Town","Monguno Town","Ngorzang"],
      "Cross River": ["Calabar","Ikom","Ogoja","Obudu","Obubra","Odukpani","Akpabuyo","Bakassi","Okuku","Ugep","Yarkurr","Yala","Abi","Biase","Etung","Ikom Town","Calabar South","Calabar North","Ogoja Town","Akamkpa","Bekwarra","Boki","Obanliku","Obudu Plateau","Odukpani Town","Ito","Mfum","Ekori","Ikom Market"],
      "Delta": ["Asaba","Warri","Sapele","Effurun","Ughelli","Kwale","Oghara","Patani","Umunede","Abraka","Ozoro","Koko","Bomadi","Burutu","Udu","Eku","Oshimili","Uvwie","Sapele Town","Warri North","Warri South","Warri South West","Asaba Town","Agbor","Ozoro Town","Ughelli Town","Koko Town","Kiagbodo","Sapele Market"],
      "Ebonyi": ["Abakaliki","Afikpo","Onicha","Ebonyi Town","Ezza","Ishielu","Izzi","Ohaukwu","Ohaozara","Onicha-Ezza","Afikpo Town","Abakaliki Town","Onueke","Nkalagu","Ivo","Ezza South","Ezza North","Ebonyi South","Ebonyi North","Ishielu Town","Amanvu","Nkaliki","Mbeke","Amasiri","Effium","Okpoto","Ohazu","Ezza Market","Ebonyi Estate"],
      "Edo": ["Benin City","Auchi","Ekpoma","Uromi","Igueben","Igarra","Irrua","Oredo","Egor","Ovia North-East","Ovia South-West","Esan Central","Esan North-East","Esan South-East","Esan West","Etsako Central","Etsako East","Etsako West","Uhunmwonde","Owan","Benin Airport","Ring Road","Sapele Road","Ugbowo","Ikpoba Hill","GRA Benin","Upper Sakponba","Sabongida Ora","Ubiaja"],
      "Ekiti": ["Ado-Ekiti","Ikere-Ekiti","Ikole","Oye-Ekiti","Ise-Ekiti","Moba","Efon","Emure","Ido-Osi","Irepodun/Ifelodun","Ilejemeje","Gbonyin","Ilawe","Ado Town","Ikere Town","Oye Town","Ise Town","Aramoko-Ekiti","Irepodun Town","Moba Town","Ikole Town","Omuo-Ekiti","Iyin-Ekiti","Ipao-Ekiti","Efon Alaaye","Ado GRA","Ayedun","Aramoko Market"],
      "Enugu": ["Enugu","Nsukka","Awgu","Udi","Oji River","Nkanu","Ezeagu","Igbo-Etiti","Igbo Eze North","Isi-Uzo","Nkanu West","Nkanu East","Udenu","Udi Town","Nsukka Town","Enugu East","Enugu North","Enugu South","Oji River Town","Agbani","Obollo-Afor","Igbo-Etiti Town","Enugu Agbani","Opi","Eha-Amufu","Amuri","Ã‰rough","Ibagwa-Aka","Awgu Town"],
      "Gombe": ["Gombe","Kaltungo","Dukku","Billiri","Yamaltu/Deba","Balanga","Akko","Kwami","Nafada","Funakaye","Kaltungo Town","Gombe Town","Dukku Town","Billiri Town","Akko Town","Kwami Town","Akko Center","Bajoga","Jabbi","Gombe North","Gombe South","Kaltungo Market","Nono","Hinna","Soba","Duwari","Tulu","Balanga Market","Deba"],
      "Imo": ["Owerri","Orlu","Okigwe","Oguta","Njaba","Mbaitoli","Ohaji-Egbema","Orsu","Oru East","Oru West","Ideato North","Ideato South","Ehime-Mbano","Ihitte/Uboma","Ngor-Okpala","Owerri North","Owerri South","Owerri West","Njaba Town","Orlu Town","Obowo","Onuimo","Nkwerre","Isu","Aboh Mbaise","Okigwe Town","Mgbidi","Umulogho","Umuahia Road"],
      "Jigawa": ["Dutse","Hadejia","Gumel","Kazaure","Ringim","Guri","Babura","Birnin Kudu","Gagarawa","Gwiwa","Kafin Hausa","Miga","Roni","Taura","Sule Tankarkar","Hadejia Town","Dutse Town","Kazaure Town","Gumel Town","Ringim Town","Guri Town","Kafin Hausa Town","Gagarawa Market","Birnin Kudu Market","Kari","Buntsari","Sunjama","Gumel Market","Kirikasamma"],
      "Kaduna": ["Kaduna","Zaria","Kafanchan","Kachia","Kagarko","Jema'a","Birnin Gwari","Kudan","Lere","Makarfi","Sabon Gari","Sanga","Zaria Town","Kaduna North","Kaduna South","Kafanchan Town","Kachia Town","Kagarko Town","Kudan Town","Lere Town","Kauru","Ikara","Giwa","Kachia Market","Kaduna International","Birnin Gwari Town","Saminaka","Kaduna GRA","Hayin Banki"],
      "Kano": ["Kano","Wudil","Rano","Gaya","Kumbotso","Gezawa","Bichi","Gwarzo","Dala","Tofa","Tarauni","Sumaila","Kano Municipal","Gwale","Ungogo","Rimin Gado","Kano Town","Madobi","Kunchi","Rogo","Kano Airport","Fagge","Kano City Centre","Kofa","Giginyu","Kano Market","Kano Pillar","Kano Polo Ground","Tudun Wada"],
      "Katsina": ["Katsina","Funtua","Daura","Kankara","Dutsin-Ma","Malumfashi","Kaita","Kankia","Jibia","Mashi","Kafur","Kusada","Funtua Town","Daura Town","Katsina Town","Dutsin Town","Malumfashi Town","Rimi","Safana","Sabuwa","Kankara Market","Kaita Town","Bakori","Zango","Kaita Village","Kankia Town","Katsina GRA","Katsina Market","Kanya"],
      "Kebbi": ["Birnin Kebbi","Argungu","Yauri","Zuru","Koko/Besse","Sakaba","Bunza","Jega","Fakai","Dandi","Augie","Maiyama","Shanga","Suru","Wasagu/Danko","Aliero","Birnin Kebbi Town","Argungu Town","Yauri Town","Zuru Town","Koki","Koko Town","Bida","Gwandu","Kebbi Market","Gawabawa","Kalgo","Suru Town","Maiyama Town"],
      "Kogi": ["Lokoja","Okene","Kabba","Idah","Ankpa","Ajaokuta","Mopa-Muro","Ofu","Ogori-Magongo","Olamaboro","Lokoja Town","Okene Town","Kabba Town","Idah Town","Ankpa Town","Ajaokuta Town","Kogi East","Kogi West","Egbe","Isanlu","Ijumu","Lokoja GRA","Lokoja Port","Egbe Town","Ayingba","Dekina","Bassa","Okehi","Okene Market"],
      "Kwara": ["Ilorin","Offa","Omu-Aran","Kaiama","Isin","Asa","Pategi","Moro","Edu","Baruten","Ilorin East","Ilorin West","Ilorin South","Irepodun","Oke-Ero","Oyun","Ifelodun","Ilorin Town","Offa Town","Omu-Aran Town","Kaiama Town","Jebba","Oyi","Bode Saadu","Ajase-Ipo","Ilemona","Sobi","Elerin"],
      "Lagos": ["Ikeja","Lekki","Victoria Island","Ikoyi","Surulere","Ajah","Yaba","Mushin","Apapa","Oshodi","Badagry","Epe","Ikorodu","Kosofe","Agege","Magodo","Festac","Ojo","Shomolu","Ojodu","Ajegunle","Anthony Village","Gbagada","Ilogbo","Ebute-Metta","Marina","Ikorodu Road","Ikeja GRA","Lekki Phase 1"],
      "Nasarawa": ["Lafia","Keffi","Akwanga","Nasarawa-Eggon","Karu","Obi","Toto","Doma","Wamba","Lafia Town","Keffi Town","Akwanga Town","Karu Town","Nasarawa Town","Nasarawa-Eggon Town","Toto Town","Obi Town","Doma Town","Keffi City","Akwanga City","Mararaba","Nyanya","Gidan-Kwano","Keffi Market","Lafia GRA","Karu Market","Kwandaragi","Assakio","Nasarawa Market"],
      "Niger": ["Minna","Bida","Kontagora","Suleja","Lapai","Mokwa","Tafa","Bosso","Edati","Gbako","Mariga","Lavun","Magama","Rafi","Wushishi","Paikoro","Katcha","Minna Town","Bida Town","Kontagora Town","Suleja Town","Tegina","Zungeru","New-Bussa","Kudu","Chukuba","Tungan-Maje","Rafi Market","Minna GRA"],
      "Ogun": ["Abeokuta","Sagamu","Ota","Ilaro","Ijebu-Ode","Ifo","Remo","Ikenne","Imeko-Afon","Obafemi-Owode","Odeda","Ipokia","Ogun Waterside","Ado-Odo/Ota","Sango-Ota","Abeokuta Town","Sagamu Town","Ilaro Town","Ijebu North","Ijebu East","Iperu","Ijebu Igbo","Ilishan-Remo","Abeokuta GRA","Mowe","Ado-Odo","Ijebu Ode Market","Itele","Ifo Market"],
      "Ondo": ["Akure","Owo","Ondo","Okitipupa","Ikare-Akoko","Ifon","Ondo Town","Akure Town","Owo Town","Okitipupa Town","Ikare Town","Idanre","Ilaje","Odigbo","Ose","Ile-Oluji","Akoko","Ondo East","Ondo West","Akure North","Akure South","Igarra","Owo Market","Oba Ile","Igbara-Odo","Arigidi","Irele","Irikemo","Oke-Igbo"],
      "Osun": ["Osogbo","Ilesa","Ife","Ede","Iwo","Ila-Orangun","Ikirun","Gbongan","Irewole","Ifelodun","Ejigbo","Orolu","Obokun","Odo Otin","Boluwaduro","Iwo Town","Osogbo Town","Ila Town","Ilesa Town","Ede North","Ede South","Iwo Market","Ipetu-Ijesha","Ife North","Ife South","Ifetedo","Igbajo","Iresi","Ile-Ife GRA"],
      "Oyo": ["Ibadan","Ogbomosho","Oyo","Saki","Iseyin","Eruwa","Oyo Town","Ibadan North","Ibadan South","Ibadan East","Ibadan West","Ogbomosho North","Ogbomosho South","Irepo","Ona-Ara","Akinyele","Lagelu","Egbeda","Kajola","Iseyin Town","Saki Town","Okeho","Okeho Market","Iseyin Market","Oyo State Secretariat","Eleyele","Bodija","Ring-Road","Oluyole"],
      "Plateau": ["Jos","Barkin Ladi","Pankshin","Langtang","Bukuru","Mangu","Riyom","Shendam","Kanke","Jos North","Jos South","Qua'an Pan","Kanam","Bokkos","Mikang","Barkin Ladi Town","Pankshin Town","Langtang North","Langtang South","Bukuru Town","Barkin Ladi Market","Jos Main Market","Jos Plateau","Angware","Fan","Pengana","Du","Riyom Town","Fobur"],
      "Rivers": ["Port Harcourt","Bonny","Ahoada","Degema","Emohua","Oyigbo","Obio-Akpor","Ogba-Egbema-Ndoni","Okrika","Omuma","Opobo/Nkoro","Ikwerre","Tai","Gokana","Khana","Port Harcourt City","Rumuokoro","Choba","Eleme","Abua/Odual","Ikoku","Rumuola","Rumuji","Degema Town","Bori","Buguma","Kpor","Aba Road","Oil Mill Market"],
      "Sokoto": ["Sokoto","Gwadabawa","Kebbe","Wurno","Goronyo","Binji","Dange Shuni","Illela","Shagari","Tambuwal","Kware","Rabah","Sokoto North","Sokoto South","Yabo","Gada","Goronyo Town","Wurno Town","Kebbe Town","Illela Town","Illela Market","Silame","Sabon Birni","Tangaza","Gidan Madi","Bodinga","Dange","Yelangbara","Sifawa"],
      "Taraba": ["Jalingo","Wukari","Takum","Bali","Sardauna","Ardo-Kola","Gassol","Zing","Ibi","Kurmi","Donga","Mutum Biyu","Jalingo Town","Wukari Town","Takum Town","Bali Town","Gassol Town","Zing Town","Donga Town","Yorro","Karim-Lamido","Jauro","Suka","Mararaba","Kente","Baissa","Ashuku","Kukeh","Jalingo GRA"],
      "Yobe": ["Damaturu","Potiskum","Gashua","Nguru","Buni Yadi","Gujba","Machina","Fune","Tarmuwa","Damaturu Town","Potiskum Town","Gashua Town","Nguru Town","Gujba Town","Karasuwa","Jakusko","Damaturu Areas","Bade","Yunusari","Fika","Fune Town","Buniyadi Market","Potiskum Market","Gashua Market","Potiskum Mall","Damaturu GRA","Machina Town","Garnai","Zaki"],
      "Zamfara": ["Gusau","Talata Mafara","Shinkafi","Anka","Maru","Kaura Namoda","Bungudu","Bakura","Zurmi","Gummi","Tsafe","Maradun","Gusau Town","Talata Town","Shinkafi Town","Kaura Namoda Town","Bakura Town","Zurmi Town","Maru Town","Anka Town","Zamfara Market","Birnin Magaji","Bungudu Town","Bungudu Market","Buya","Bungudu Junction","Gusau GRA","Gummi Town","Talata Market"],
      "FCT": ["Abuja","Gwarinpa","Asokoro","Wuse","Garki","Kubwa","Kuje","Bwari","Gwagwalada","Maitama","Wuse II","Jabi","Lugbe","Gwarimpa Phase 1","Gwarimpa Phase 2","Wuye","Utako","Katampe","LifeCamp","Utako Town","Karshi","Mbora (Nyanya)","Zuba","Karu","Apo","Dutse-Alhaji","Mararaba","Kubwa Extension","Gwagwalada Market"]
    };

    // populate datalist and wire area select
    (function initStatesAndAreas(){
      const dl = document.getElementById('stateList');
      if (!dl) return;
      dl.innerHTML = '';
      Object.keys(MAJOR_TOWNS).sort().forEach(st => {
        const opt = document.createElement('option'); opt.value = st; dl.appendChild(opt);
      });

      const stateInput = document.getElementById('stateInput');
      const areaSelect = document.getElementById('areaSelect');

      function populateAreas(state) {
        areaSelect.innerHTML = '';
        const towns = MAJOR_TOWNS[state] || [];
        if (!towns.length) {
          const op = document.createElement('option'); op.value = ''; op.textContent = 'No towns available for this state'; areaSelect.appendChild(op); return;
        }
        const choose = document.createElement('option'); choose.value = ''; choose.textContent = 'Choose town / city'; areaSelect.appendChild(choose);
        towns.forEach(t => { const op = document.createElement('option'); op.value = t; op.textContent = t; areaSelect.appendChild(op); });
      }

      // respond to typing, selection and blur â€” preserves original behavior but ensures robust population
      stateInput.addEventListener('input', () => {
        // do not immediately populate on every keystroke to keep typing behavior smooth
        // but if exact match to a state option exists, populate areas
        const val = stateInput.value.trim();
        if (val && MAJOR_TOWNS[val]) populateAreas(val);
      });

      stateInput.addEventListener('change', () => populateAreas(stateInput.value || ''));
      stateInput.addEventListener('blur', () => populateAreas(stateInput.value || ''));
      if (stateInput.value) populateAreas(stateInput.value);
    })();

    // ---------- Firebase helper ready check ----------
    async function ensureRealtimeHelperReady(timeoutMs = 5000) {
      const ready = await waitFor(() => typeof window.saveOrderToRealtime === "function", timeoutMs);
      return ready;
    }

    // ---------- Checkout (modified only to include state & area) ----------
    window.payWithPaystack = async function() {
      const name = document.getElementById("name").value.trim();
      const phone = document.getElementById("phone").value.trim();
      const email = document.getElementById("email").value.trim();
      const address = document.getElementById("address").value.trim();
      const state = document.getElementById("stateInput").value.trim();
      const area = document.getElementById("areaSelect").value.trim();

      if (!name || !phone || !email || !address || !state || !area) {
        alert("Please fill all details (including State and Town) before checkout!");
        return;
      }

      if (!cart || cart.length === 0) {
        alert("Your cart is empty.");
        return;
      }

      const totalAmount = cart.reduce((sum, it) => sum + ((it.price || 0) * (it.quantity || 1)), 0);

      const cartWithStatus = (cart || []).map(it => ({
        name: it.name,
        image: it.image || "",
        price: Number(it.price || 0),
        quantity: Number(it.quantity || 1),
        status: "pending"
      }));

      const orderData = {
        customer: { name, phone, email, address, state, area },
        cart: cartWithStatus,
        totalAmount,
        status: "pending",
      };

      // Wait for realtime helper
      statusMsg.textContent = "Connecting to database...";
      const ready = await ensureRealtimeHelperReady(6000);
      if (!ready) {
        statusMsg.textContent = "Could not connect to Firebase Realtime Database. Try refreshing.";
        alert("Firebase helper not ready. Refresh the page and try again.");
        return;
      }

      try {
        statusMsg.textContent = "Saving order...";
        const res = await window.saveOrderToRealtime(orderData); // { key: '...' }
        console.log("Order saved, key:", res.key);

        // Remove cart then redirect to thankyou page with key so customer can watch approval/payment
        localStorage.removeItem(cartKey);
        statusMsg.textContent = "";

        try {
          localStorage.setItem("lastOrderKey", res.key);
          window.location.href = "thankyou.html?key=" + encodeURIComponent(res.key);
        } catch (e) {
          alert("Order saved! Reference: " + res.key);
        }
      } catch (err) {
        console.error("Error saving order to Realtime DB:", err);
        statusMsg.textContent = "Error saving order. Check console.";
        alert("Error saving order. See console for details.");
      }
    };

    // wire click to existing button
    document.addEventListener("DOMContentLoaded", function () {
      renderCart();
      const btn = document.getElementById("checkoutBtn");
      if (btn) {
        btn.addEventListener("click", () => { if (typeof window.payWithPaystack === "function") window.payWithPaystack(); });
      }
    });

    // Re-render on storage change
    window.addEventListener("storage", function (e) {
      if (possibleKeys.includes(e.key)) renderCart();
    });
  </script>
    <style>
#vChatBtn{
  position:fixed; left:10px;bottom:90px;
  width:50px;height:50px;border-radius:50%;
  background:#25D366;color:#fff;font-size:18px;
  display:flex;align-items:center;justify-content:center;
  box-shadow:0 4px 18px rgba(0,0,0,.25);
  cursor:pointer;z-index:10000;
  animation:pulse 1.4s infinite;
}
@keyframes pulse{
  0%,100%{transform:scale(1);opacity:1}
  50%{transform:scale(1.15);opacity:.9}
}
#vChatOverlay{
  position:fixed;inset:0;z-index:9999;
  background:#fff;display:none;flex-direction:column;
  font-family:Arial,Helvetica,sans-serif;
}
#vChatOverlay header{
  background:#25D366;color:#fff;
  padding:10px;font-size:10px;font-weight:700;
  display:flex;justify-content:space-between;align-items:center;
}
#vChatOverlay header button{
  background:none;border:none;color:#fff;
  font-size:22px;cursor:pointer;
}
#vChatOverlay .body{
  flex:1;padding:10px;overflow:auto;
  display:flex;flex-direction:column;justify-content:center;
  text-align:center;font-size:16px;color:#333;
}
#vChatOverlay textarea{
  width:90%;max-width:500px;height:100px;
  margin:0 auto 20px;border-radius:8px;
  border:1px solid #ccc;padding:10px;resize:none;
  font-size:15px;
}
#vChatOverlay .send{
  background:#25D366;color:#fff;border:none;
  padding:10px 20px;border-radius:8px;
  font-size:16px;font-weight:700;cursor:pointer;
}
</style>

<div id="vChatBtn" title="Chat with us">ðŸ’¬</div>

<div id="vChatOverlay">
  <header>
    <span>Chat with VBest</span>
    <button id="vClose">Ã—</button>
  </header>
  <div class="body">
    <textarea id="vMsg" placeholder="Hi! Tell us what you need (size, budget, color â€¦)"></textarea>
    <button class="send" id="vSend">Send on WhatsApp</button>
  </div>
</div>

<script>
const btn=document.getElementById('vChatBtn');
const overlay=document.getElementById('vChatOverlay');
const close=document.getElementById('vClose');
const send=document.getElementById('vSend');
const msg=document.getElementById('vMsg');
const phone="2347080535579"; // your WhatsApp number

btn.onclick=()=>overlay.style.display="flex";
close.onclick=()=>overlay.style.display="none";
send.onclick=()=>{
  const text=msg.value.trim();
  if(!text){alert("Please type a message.");return;}
  const url="https://wa.me/"+phone+"?text="+encodeURIComponent(text);
  window.open(url,"_blank");
  msg.value="";
  overlay.style.display="none";
};
</script>
</body>
</html>